Refactor router, controller to be loosely coupled